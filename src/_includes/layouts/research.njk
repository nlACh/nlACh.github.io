{% extends "layouts/base.njk" %}

{% block content %}
<section class="page-section wrapper">
  <header class="page-header-section">
    <h1>{{ title }}</h1>
    <h3 class="page-intro">{{ content | safe }}</h3>
  </header>

  {# Journal Publications #}
  <section class="publications-section" id="journals">
    <h2 class="page-header-section"> Journal Publications</h2>
    <div class="publications-grid">
      {% for item in collections.publication_id %}
        <article class="publication-card publication-card-horizontal">
          {% if item.data.image %}
          <div class="pub-image-side">
            <img src="/content/pub_type/1-pubs/{{ item.data.image }}" alt="Graphical abstract" loading="lazy">
          </div>
          {% endif %}
          <div class="pub-content-side">
            <h3 class="pub-title">{{ item.data.title }}</h3>
            <p class="pub-authors">{{ item.data.authors }}</p>
            <p class="pub-venue">
              <strong>{{ item.data.jorunal }}
              {% if item.data.pub_year %} ({{ item.data.pub_year }}){% endif %}</strong>
            </p>
            {% if item.data.doi %}
            <p class="pub-venue">
              <strong>DOI: {{ item.data.doi }}</strong>  
            </p>
            {% endif %}
            <div class="pub-actions">
              {% if item.data.doi %}
                <a href="{{ item.data.doi }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                  <span>View Paper</span>
                </a>
              {% endif %}
              {% if item.data.abstract %}
                <button class="btn btn-secondary abstract-toggle" data-target="abstract-j{{ loop.index }}">
                  <span class="toggle-text">Show Abstract</span>
                </button>
              {% endif %}
            </div>
            {% if item.data.abstract %}
            <div class="pub-abstract abstract-collapsible" id="abstract-j{{ loop.index }}">
              {{ item.data.abstract }}
            </div>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  </section>

  {# Conference Papers #}
  <section class="publications-section" id="conferences">
    <h2>Conference Papers</h2>
    <div class="publications-grid">
      {% for item in collections.conf_id %}
        <article class="publication-card publication-card-horizontal">
          {% if item.data.image %}
          <div class="pub-image-side">
            <img src="/content/pub_type/2-confs/{{ item.data.image }}" alt="Publication figure" loading="lazy">
          </div>
          {% endif %}
          <div class="pub-content-side">
            <h3 class="pub-title">{{ item.data.title }}</h3>
            <p class="pub-authors">{{ item.data.authors }}</p>
            <p class="pub-venue"><strong>{{ item.data.event }}</strong></p>
            {% if item.data.doi %}
            <p class="pub-venue"><strong>DOI: {{ item.data.doi }}</strong></p>
            {% endif %}
            <div class="pub-actions">
              {% if item.data.proceedings %}
                <a href="{{ item.data.proceedings }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                  <span>Proceedings</span>
                </a>
              {% endif %}
              {% if item.data.presentation_file %}
                <!--
                <a href="/content/pub_type/2-confs/{{ item.data.presentation_file }}" download class="btn btn-secondary">
                  Slides
                </a>
                -->
                <button class="btn btn-outline pdf-view-btn" data-pdf="/content/pub_type/2-confs/{{ item.data.presentation_file }}">
                  View Presentation
                </button>
              {% endif %}
              {% if item.data.abstract_file %}
                <!--
                <a href="/content/pub_type/2-confs/{{ item.data.abstract_file }}" download class="btn btn-outline">
                  <span>Abstract</span>
                </a>
                -->
                <button class="btn btn-outline pdf-view-btn" data-pdf="/content/pub_type/2-confs/{{ item.data.abstract_file }}">
                  View Abstract
                </button>
              {% endif %}
              {% if item.data.poster_file %}
                <button class="btn btn-outline pdf-view-btn" data-pdf="/content/pub_type/2-confs/{{ item.data.poster_file }}">
                  View Poster
                </button>
              {% endif %}
              {% if item.data.abstract %}
                <button class="btn btn-secondary abstract-toggle" data-target="abstract-c{{ loop.index }}">
                  <span class="toggle-text">Show Abstract</span>
                </button>
              {% endif %}
            </div>
            {% if item.data.abstract %}
            <div class="pub-abstract abstract-collapsible" id="abstract-c{{ loop.index }}">
              <p>{{ item.data.abstract }}</p>
            </div>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  </section>

  {# Preprints #}
  <section class="publications-section" id="preprints">
    <h2>Preprints</h2>
    <div class="publications-grid">
      {% for item in collections.preprint_id %}
        <article class="publication-card publication-card-horizontal">
          {% if item.data.image %}
          <div class="pub-image-side">
            <img src="/content/pub_type/3-preprints/{{ item.data.image }}" alt="Publication figure" loading="lazy">
          </div>
          {% endif %}
          <div class="pub-content-side">
            <h3 class="pub-title">{{ item.data.title }}</h3>
            <p class="pub-authors">{{ item.data.authors }}</p>
            <p class="pub-venue">Preprint {% if item.data.pub_year %}({{ item.data.pub_year }}){% endif %}</p>
            <div class="pub-actions">
              {% if item.data.preprint_addr %}
                <a href="{{ item.data.preprint_addr }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                  <span>View Preprint</span>
                </a>
              {% endif %}
              {% if item.data.alt_available == "Yes" and item.data.alt_addr %}
                <a href="{{ item.data.alt_addr }}" target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                  <span>Alternative Link</span>
                </a>
              {% endif %}
              {% if item.data.abstract %}
                <button class="btn btn-secondary abstract-toggle" data-target="abstract-p{{ loop.index }}">
                  <span class="toggle-text">Show Abstract</span>
                </button>
              {% endif %}
            </div>
            {% if item.data.abstract %}
            <div class="pub-abstract abstract-collapsible" id="abstract-p{{ loop.index }}">
              <p>{{ item.data.abstract }}</p>
            </div>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  </section>
  <!--
  {# Posters & Presentations - Merged from posters page #}
  <section class="publications-section" id="posters">
    <h2><span class="section-icon">ðŸ“Œ</span> Posters &amp; Presentations</h2>
    <div class="publications-grid">
      <article class="publication-card publication-card-horizontal">
        <div class="pub-image-side poster-preview-side">
          <div class="poster-placeholder">
            <span class="poster-icon">ðŸ“Œ</span>
            <span>Research Poster</span>
          </div>
        </div>
        <div class="pub-content-side">
          <h3 class="pub-title">Understanding the composition dependent charge qubit performance of a dual-gate Al<sub>x</sub>Ga<sub>1-x</sub>As nanowire FET</h3>
          <p class="pub-authors">N. Paul, B. Nag Chowdhury, S. Chattopadhyay</p>
          <p class="pub-venue">22nd International Workshop on the Physics of Semiconductor Devices (IWPSD 2023)</p>
          <p class="pub-date">December 13-17, 2023</p>
          <div class="pub-actions">
            <button class="btn btn-primary pdf-view-btn" data-pdf="/content/pub_type/2-confs/IWPSD2023_NPaul_Poster_V1.pdf">
              <span>ðŸ“„ View Poster</span>
            </button>
            <a href="/content/pub_type/2-confs/IWPSD2023_NPaul_Poster_V1.pdf" download class="btn btn-secondary">
              <span>ðŸ“¥ Download Poster</span>
            </a>
            <a href="/content/pub_type/2-confs/Abstract_IWPSD23_NPaul.pdf" download class="btn btn-outline">
              <span>ðŸ“„ Download Abstract</span>
            </a>
          </div>
        </div>
      </article>
    </div>
  </section>
  -->
</section>

{# PDF Modal #}
<div class="pdf-modal" id="pdfModal">
  <div class="pdf-modal-backdrop"></div>
  <div class="pdf-modal-content">
    <button class="pdf-modal-close" aria-label="Close modal">&times;</button>
    <iframe id="pdfViewer" src="" title="PDF Viewer"></iframe>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Abstract toggle functionality with smooth animation
  const abstractToggles = document.querySelectorAll('.abstract-toggle');
  abstractToggles.forEach(function(btn) {
    btn.addEventListener('click', function() {
      const targetId = this.getAttribute('data-target');
      const target = document.getElementById(targetId);
      const toggleText = this.querySelector('.toggle-text');
      
      if (target) {
        const isExpanded = target.classList.contains('abstract-expanded');
        
        if (isExpanded) {
          target.classList.remove('abstract-expanded');
          this.classList.remove('active');
          if (toggleText) toggleText.textContent = 'Show Abstract';
        } else {
          target.classList.add('abstract-expanded');
          this.classList.add('active');
          if (toggleText) toggleText.textContent = 'Hide Abstract';
        }
      }
    });
  });

  // PDF Modal functionality
  const pdfModal = document.getElementById('pdfModal');
  const pdfViewer = document.getElementById('pdfViewer');
  const pdfViewBtns = document.querySelectorAll('.pdf-view-btn');
  const modalBackdrop = document.querySelector('.pdf-modal-backdrop');
  const modalClose = document.querySelector('.pdf-modal-close');

  function openModal(pdfUrl) {
    pdfViewer.src = pdfUrl;
    pdfModal.classList.add('pdf-modal-open');
    document.body.style.overflow = 'hidden';
  }

  function closeModal() {
    pdfModal.classList.remove('pdf-modal-open');
    pdfViewer.src = '';
    document.body.style.overflow = '';
  }

  pdfViewBtns.forEach(function(btn) {
    btn.addEventListener('click', function() {
      const pdfUrl = this.getAttribute('data-pdf');
      if (pdfUrl) {
        openModal(pdfUrl);
      }
    });
  });

  if (modalBackdrop) {
    modalBackdrop.addEventListener('click', closeModal);
  }

  if (modalClose) {
    modalClose.addEventListener('click', closeModal);
  }

  // Close modal on ESC key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && pdfModal.classList.contains('pdf-modal-open')) {
      closeModal();
    }
  });
});
</script>
{% endblock %}
